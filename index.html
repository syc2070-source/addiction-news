<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>중독뉴스 | Addiction Newsroom</title>
    <meta
      name="description"
      content="도박·게임·알코올·약물·디지털 중독 및 시사 이슈와 관련된 전 세계 뉴스를 한국어로 요약·정리하는 중독 전문 뉴스룸입니다."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      :root {
        --bg: #020617;
        --bg-soft: #020617;
        --fg: #e5e7eb;
        --fg-muted: #9ca3af;
        --accent: #60a5fa;
        --accent-strong: #38bdf8;
        --border-subtle: #111827;
        --card-bg: rgba(15, 23, 42, 0.98);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #0b1f3a, #020617 55%);
        color: var(--fg);
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      /* 상단 네비게이션 */
      .top-nav {
        position: sticky;
        top: 0;
        z-index: 20;
        backdrop-filter: blur(16px);
        background: linear-gradient(
          to bottom,
          rgba(2, 6, 23, 0.95),
          rgba(2, 6, 23, 0.75)
        );
        border-bottom: 1px solid rgba(15, 23, 42, 0.95);
      }

      .top-nav-inner {
        max-width: 1040px;
        margin: 0 auto;
        padding: 10px 16px 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand-logo {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 20%, #38bdf8, #0f172a);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: 700;
        color: #e0f2fe;
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.4);
      }

      .brand-text-main {
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.04em;
      }

      .brand-text-sub {
        font-size: 0.7rem;
        color: var(--fg-muted);
      }

      .nav-links {
        display: flex;
        gap: 12px;
        font-size: 0.8rem;
      }

      .nav-links a {
        color: var(--fg-muted);
      }

      .nav-links a:hover {
        color: var(--fg);
      }

      /* 페이지 전체 레이아웃 */
      .page {
        max-width: 1040px;
        margin: 0 auto;
        padding: 18px 16px 28px;
      }

      @media (max-width: 768px) {
        .page {
          padding: 14px 10px 24px;
        }
        .top-nav-inner {
          padding-inline: 10px;
        }
      }

      header.page-header {
        margin-bottom: 18px;
      }

      .title-row {
        display: flex;
        align-items: baseline;
        gap: 10px;
        flex-wrap: wrap;
      }

      h1 {
        margin: 0;
        font-size: 1.8rem;
        letter-spacing: 0.03em;
      }

      .badge {
        font-size: 0.75rem;
        padding: 3px 9px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        color: var(--fg-muted);
      }

      .page-sub {
        margin-top: 6px;
        font-size: 0.85rem;
        color: var(--fg-muted);
        line-height: 1.5;
      }

      .page-sub code {
        font-size: 0.75rem;
        background: rgba(15, 23, 42, 0.9);
        padding: 2px 4px;
        border-radius: 4px;
      }

      /* 메인 레이아웃 */
      .main-layout {
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
        gap: 16px;
      }

      @media (max-width: 880px) {
        .main-layout {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .filter-card {
        grid-column: 1 / -1;
        margin-bottom: 4px;
        padding: 10px 12px 9px;
        border-radius: 16px;
        border: 1px solid rgba(30, 64, 175, 0.7);
        background: linear-gradient(
          135deg,
          rgba(15, 23, 42, 0.96),
          rgba(15, 23, 42, 0.9)
        );
        box-shadow: 0 14px 32px rgba(15, 23, 42, 0.85);
      }

      .filter-head {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 10px;
        margin-bottom: 8px;
      }

      .filter-label {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--fg-muted);
      }

      .filter-label span {
        color: var(--accent-strong);
      }

      .filter-info {
        font-size: 0.75rem;
        color: var(--fg-muted);
        text-align: right;
      }

      .chip-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .chip {
        font-size: 0.78rem;
        padding: 4px 11px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.45);
        background: rgba(15, 23, 42, 0.96);
        color: var(--fg-muted);
        cursor: pointer;
        transition: all 0.16s ease-out;
      }

      .chip:hover {
        border-color: rgba(96, 165, 250, 0.95);
        color: #dbeafe;
      }

      .chip.active {
        background: radial-gradient(
          circle at top left,
          rgba(37, 99, 235, 0.95),
          #020617
        );
        color: #e0f2fe;
        border-color: rgba(96, 165, 250, 0.98);
        box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.5);
      }

      .list-card {
        padding: 10px 12px 12px;
        border-radius: 16px;
        border: 1px solid var(--border-subtle);
        background: var(--card-bg);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      }

      .section-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin: 0 0 8px;
      }

      .section-title span {
        color: var(--accent-strong);
      }

      .news-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .news-item {
        padding: 8px 8px 7px;
        border-radius: 12px;
        border: 1px solid rgba(30, 64, 175, 0.7);
        background: radial-gradient(
          circle at top left,
          rgba(15, 23, 42, 0.9),
          rgba(15, 23, 42, 1)
        );
      }

      .news-meta {
        font-size: 0.75rem;
        color: var(--fg-muted);
        margin-bottom: 3px;
      }

      .news-title {
        font-size: 0.95rem;
        margin: 0 0 3px;
      }

      .news-summary {
        font-size: 0.86rem;
        margin: 0 0 4px;
        color: #e5e7eb;
      }

      .news-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.75rem;
        color: var(--fg-muted);
      }

      .news-footer-left {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .pill {
        padding: 1px 7px;
        border-radius: 999px;
        border: 1px solid rgba(75, 85, 99, 0.85);
        font-size: 0.7rem;
      }

      .focus-card {
        padding: 10px 12px 12px;
        border-radius: 16px;
        border: 1px solid rgba(30, 64, 175, 0.85);
        background: radial-gradient(
          circle at top left,
          rgba(30, 64, 175, 0.7),
          rgba(15, 23, 42, 1)
        );
        box-shadow: 0 20px 45px rgba(15, 23, 42, 0.95);
      }

      .focus-kicker {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: #bfdbfe;
        margin-bottom: 4px;
      }

      .focus-title {
        font-size: 1.05rem;
        margin: 0 0 4px;
      }

      .focus-meta {
        font-size: 0.78rem;
        color: #bfdbfe;
        margin-bottom: 6px;
      }

      .focus-summary {
        font-size: 0.87rem;
        margin: 0 0 6px;
        color: #e5f0ff;
      }

      .focus-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.76rem;
        color: #bfdbfe;
      }

      .focus-pill {
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(191, 219, 254, 0.8);
        font-size: 0.7rem;
      }

      .focus-empty {
        font-size: 0.8rem;
        color: #e5e7eb;
      }

      .focus-note {
        margin-top: 6px;
        font-size: 0.75rem;
        color: rgba(226, 232, 240, 0.8);
      }

      footer {
        margin-top: 16px;
        font-size: 0.75rem;
        color: var(--fg-muted);
        text-align: center;
        padding-top: 10px;
        border-top: 1px solid rgba(15, 23, 42, 0.9);
      }
    </style>
  </head>
  <body>
    <nav class="top-nav">
      <div class="top-nav-inner">
        <div class="brand">
          <div class="brand-logo">N</div>
          <div>
            <div class="brand-text-main">중독뉴스</div>
            <div class="brand-text-sub">
              Addiction Intelligence Newsroom
            </div>
          </div>
        </div>
        <div class="nav-links">
          <a href="#">홈</a>
          <a href="#">데이터 허브(예정)</a>
          <a
            href="https://syc2070-source.github.io/addiction-society/"
            target="_blank"
            >중독사회로 이동 ↗</a
          >
        </div>
      </div>
    </nav>

    <div class="page">
      <header class="page-header">
        <div class="title-row">
          <h1>오늘의 중독·시사 브리핑</h1>
          <span class="badge">전 세계 중독·도박·시사 동향 요약</span>
        </div>
        <p class="page-sub">
          도박·게임·알코올·약물·디지털 중독과 관련된 글로벌 뉴스, 그리고 구조적
          위험을 보여 주는 <strong>시사 이슈</strong>를 선별해 한국어로
          요약합니다. 데이터는 <code>data/news.txt</code> 파일에서 관리되며,
          향후 자동 수집·번역·요약 파이프라인과 QAICLE 통계엔진과의 연동을
          목표로 합니다.
        </p>
      </header>

      <section class="main-layout">
        <div class="filter-card">
          <div class="filter-head">
            <div class="filter-label">
              카테고리 필터
              <span>전체 / 중독 유형 / 시사</span>
            </div>
            <div class="filter-info">
              관심 있는 영역(도박정책·게임·알코올·약물·연구·치유·시사)을 선택하면
              오른쪽 포커스와 아래 리스트가 함께 바뀝니다.
            </div>
          </div>
          <div id="category-chips" class="chip-row"></div>
        </div>

        <div class="list-card">
          <h2 class="section-title">
            최신 기사 <span id="category-label">(전체)</span>
          </h2>
          <div id="news-list" class="news-list">
            <p style="font-size:0.85rem;color:#9ca3af;">
              뉴스를 불러오는 중입니다...
            </p>
          </div>
        </div>

        <aside class="focus-card">
          <div id="focus-content">
            <p class="focus-empty">
              포커스 기사를 불러오는 중입니다...
            </p>
          </div>
          <p class="focus-note">
            가장 최근 기사 중 한 건을 <strong>오늘의 포커스</strong>로
            보여줍니다. 카테고리를 바꾸면 해당 영역 내 최신 기사가 여기로
            올라옵니다.
          </p>
        </aside>
      </section>

      <footer>
        © <span id="year"></span> 중독뉴스 · Addiction Intelligence Newsroom ·
        GitHub Pages 기반 정적 사이트
      </footer>
    </div>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear();

      const CATEGORIES = [
        "전체",
        "도박정책",
        "게임·디지털",
        "알코올·약물",
        "연구·논문",
        "치유·회복",
        "시사",
        "기타"
      ];

      let allNews = [];
      let currentCategory = "전체";

      // 카테고리 칩 렌더링
      function renderCategoryChips() {
        const container = document.getElementById("category-chips");
        container.innerHTML = CATEGORIES.map(
          (cat) => `
            <button
              class="chip ${cat === currentCategory ? "active" : ""}"
              data-category="${cat}"
            >
              ${cat}
            </button>
          `
        ).join("");

        container.querySelectorAll(".chip").forEach((chip) => {
          chip.addEventListener("click", () => {
            currentCategory = chip.dataset.category;
            renderCategoryChips();
            updateView();
          });
        });
      }

      function updateView() {
        const label = document.getElementById("category-label");
        label.textContent =
          currentCategory === "전체" ? "(전체)" : `(${currentCategory})`;

        let candidates =
          currentCategory === "전체"
            ? allNews
            : allNews.filter(
                (n) => (n.category || "기타") === currentCategory
              );

        const featured = candidates[0] || null;
        const rest = featured ? candidates.slice(1) : candidates;

        renderFocus(featured);
        renderNewsList(rest);
      }

      function renderFocus(item) {
        const container = document.getElementById("focus-content");
        if (!item) {
          container.innerHTML =
            '<p class="focus-empty">선택한 카테고리에 해당하는 최신 포커스 기사가 아직 없습니다.</p>';
          return;
        }

        const date = item.date || "";
        const category = item.category || "기타";
        const source = item.source || "";
        const summary = item.summary_ko || "";
        const country = item.country || "";

        container.innerHTML = `
          <div class="focus-kicker">Today&#39;s Focus</div>
          <h2 class="focus-title">
            <a href="${item.url}" target="_blank" rel="noopener noreferrer">
              ${item.title}
            </a>
          </h2>
          <div class="focus-meta">
            [${category}] ${
          country ? country + " · " : ""
        }${date} · ${source}
          </div>
          <p class="focus-summary">${summary}</p>
          <div class="focus-footer">
            <div>
              ${
                country
                  ? `<span class="focus-pill">${country}</span>`
                  : ""
              }
              ${
                category
                  ? `<span class="focus-pill">${category}</span>`
                  : ""
              }
            </div>
            <div>
              <a href="${item.url}" target="_blank" rel="noopener noreferrer">
                원문 전체 보기 ↗
              </a>
            </div>
          </div>
        `;
      }

      function renderNewsList(list) {
        const container = document.getElementById("news-list");

        if (!allNews.length) {
          container.innerHTML =
            '<p style="font-size:0.85rem;color:#9ca3af;">등록된 뉴스가 없습니다.</p>';
          return;
        }

        if (!list.length) {
          container.innerHTML =
            '<p style="font-size:0.85rem;color:#9ca3af;">포커스 기사 외에 추가로 보여 줄 기사가 없습니다.</p>';
          return;
        }

        container.innerHTML = list
          .map((n) => {
            const date = n.date || "";
            const category = n.category || "기타";
            const source = n.source || "";
            const summary = n.summary_ko || "";
            const country = n.country || "";

            return `
              <article class="news-item">
                <div class="news-meta">
                  [${category}] ${
              country ? country + " · " : ""
            }${date} · ${source}
                </div>
                <h3 class="news-title">
                  <a href="${n.url}" target="_blank" rel="noopener noreferrer">
                    ${n.title}
                  </a>
                </h3>
                <p class="news-summary">${summary}</p>
                <div class="news-footer">
                  <div class="news-footer-left">
                    ${
                      country
                        ? `<span class="pill">${country}</span>`
                        : ""
                    }
                    ${
                      category
                        ? `<span class="pill">${category}</span>`
                        : ""
                    }
                  </div>
                  <div>
                    <a href="${n.url}" target="_blank" rel="noopener noreferrer">
                      원문 보기 ↗
                    </a>
                  </div>
                </div>
              </article>
            `;
          })
          .join("");
      }

      // news.txt 파싱
      function parseNewsText(text) {
        const lines = text.split(/\r?\n/);
        const blocks = [];
        let current = [];

        for (const rawLine of lines) {
          const line = rawLine.replace(/\s+$/, "");
          if (line.trim().startsWith("===")) {
            if (current.length) {
              blocks.push(current.join("\n").trim());
              current = [];
            }
          } else {
            current.push(line);
          }
        }
        if (current.length) {
          blocks.push(current.join("\n").trim());
        }

        const articles = [];

        for (const block of blocks) {
          if (!block) continue;
          const obj = {};

          const getSingle = (label) => {
            const re = new RegExp("^" + label + "\\s*:\\s*(.*)$", "m");
            const m = block.match(re);
            return m ? m[1].trim() : "";
          };

          obj.title = getSingle("제목");
          obj.category = getSingle("카테고리") || "기타";
          obj.date = getSingle("날짜");
          obj.country = getSingle("국가");
          obj.source = getSingle("출처");
          obj.url = getSingle("링크");

          const lines = block.split(/\r?\n/);
          const summaryIndex = lines.findIndex((l) =>
            l.trim().startsWith("요약:")
          );
          if (summaryIndex >= 0) {
            const summaryLines = lines.slice(summaryIndex + 1);
            obj.summary_ko = summaryLines.join("\n").trim();
          } else {
            obj.summary_ko = "";
          }

          if (obj.title) {
            articles.push(obj);
          }
        }

        return articles;
      }

      async function loadNews() {
        try {
          const res = await fetch("data/news.txt?v=" + Date.now());
          if (!res.ok) {
            console.warn("news.txt 를 불러오지 못했습니다.");
            allNews = [];
            renderNewsList([]);
            renderFocus(null);
            return;
          }

          const text = await res.text();
          allNews = parseNewsText(text);

          allNews = allNews.slice().sort((a, b) => {
            if (!a.date || !b.date) return 0;
            return a.date < b.date ? 1 : -1;
          });

          renderCategoryChips();
          updateView();
        } catch (e) {
          console.error("뉴스 로딩 중 오류:", e);
          const list = document.getElementById("news-list");
          list.innerHTML =
            '<p style="font-size:0.85rem;color:#f97373;">뉴스를 불러오는 중 오류가 발생했습니다.</p>';
          const focus = document.getElementById("focus-content");
          focus.innerHTML =
            '<p class="focus-empty">포커스 기사를 불러오는 중 오류가 발생했습니다.</p>';
        }
      }

      loadNews();
      renderCategoryChips();
    </script>
  </body>
</html>
