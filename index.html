<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>중독뉴스 · Addiction Intelligence Newsroom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* 기본 스타일 */
    :root {
      --bg: #050816;
      --bg-soft: #080d1f;
      --card: #0b1024;
      --accent: #36cfc9;
      --accent-soft: rgba(54, 207, 201, 0.12);
      --accent-strong: #4ce0d9;
      --text-main: #f5f7ff;
      --text-muted: #a3b1d3;
      --border-soft: #20263d;
      --badge-editor: #3b82f6;
      --badge-auto: #22c55e;
      --chip-bg: #0f172a;
      --chip-border: #1e293b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 40%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 32px 16px 48px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
      gap: 16px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-badge {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #4ce0d9, #0f172a 70%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #0b1024;
      box-shadow: 0 0 25px rgba(76, 224, 217, 0.5);
    }

    .logo-text-main {
      font-size: 20px;
      font-weight: 700;
    }

    .logo-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      gap: 12px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .nav-link-pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .nav-link-pill.accent {
      border-color: var(--accent);
      color: var(--accent-strong);
      background: rgba(54, 207, 201, 0.08);
    }

    /* 제목/설명 섹션 */
    .hero {
      margin-bottom: 24px;
    }

    .hero-title-row {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .hero-title {
      font-size: 26px;
      font-weight: 700;
    }

    .hero-tag {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-muted);
    }

    .hero-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .hero-subtitle code {
      font-family: inherit;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.9);
      color: var(--accent-strong);
      font-size: 11px;
    }

    /* 필터 섹션 */
    .filter-bar {
      margin-top: 24px;
      margin-bottom: 20px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.92));
      backdrop-filter: blur(18px);
    }

    .filter-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
    }

    .filter-top-row-left {
      font-size: 11px;
      color: var(--text-muted);
    }

    .filter-top-row-right {
      font-size: 11px;
      color: var(--accent-strong);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid var(--chip-border);
      background: var(--chip-bg);
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s ease-out;
    }

    .chip:hover {
      border-color: rgba(148, 163, 184, 0.9);
      color: var(--text-main);
    }

    .chip.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent-strong);
    }

    /* 레이아웃: 리스트 + 포커스 */
    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.6fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* 기사 리스트 카드 */
    .section-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
    }

    .section-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .article-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .article-card {
      background: linear-gradient(135deg, rgba(10, 15, 35, 0.96), rgba(7, 10, 25, 0.96));
      border-radius: 14px;
      border: 1px solid rgba(30, 64, 175, 0.2);
      padding: 10px 12px 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      position: relative;
      overflow: hidden;
    }

    .article-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .pill {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .pill-country {
      border-color: rgba(94, 234, 212, 0.7);
      color: rgba(94, 234, 212, 0.9);
    }

    .pill-date {
      border-color: rgba(148, 163, 184, 0.5);
    }

    .pill-cat {
      border-color: rgba(56, 189, 248, 0.7);
      color: rgba(56, 189, 248, 0.9);
    }

    .pill-source {
      border-color: rgba(148, 163, 184, 0.4);
    }

    .pill-badge-editor {
      border-color: rgba(59, 130, 246, 0.7);
      color: rgba(129, 199, 255, 0.95);
    }

    .pill-badge-auto {
      border-color: rgba(34, 197, 94, 0.7);
      color: rgba(74, 222, 128, 0.95);
    }

    .article-title-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: flex-start;
      margin-bottom: 3px;
    }

    .article-title {
      font-size: 14px;
      font-weight: 600;
    }

    .article-summary {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.45;
    }

    .article-footer {
      margin-top: 5px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--accent-strong);
    }

    .article-footer a {
      text-decoration: underline;
      text-underline-offset: 2px;
      font-weight: 500;
    }

    .article-footer-right {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* 포커스 카드 */
    .focus-card {
      background: radial-gradient(circle at top left, rgba(76, 224, 217, 0.18), transparent 60%),
                  radial-gradient(circle at bottom right, rgba(37, 99, 235, 0.35), #020617 70%);
      border-radius: 18px;
      border: 1px solid rgba(37, 99, 235, 0.6);
      padding: 14px 14px 16px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.8);
    }

    .focus-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .focus-tag-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      font-size: 10px;
      margin-bottom: 6px;
    }

    .focus-heading {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .focus-summary {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.5;
      margin-bottom: 8px;
    }

    .focus-footer {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      font-size: 11px;
    }

    .focus-footer a {
      color: var(--accent-strong);
      text-decoration: underline;
      text-underline-offset: 2px;
    }

    footer {
      margin-top: 28px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .muted-link {
      color: var(--text-muted);
      text-decoration: underline;
      text-underline-offset: 2px;
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="logo">
      <div class="logo-badge">N</div>
      <div>
        <div class="logo-text-main">중독뉴스</div>
        <div class="logo-text-sub">Addiction Intelligence Newsroom</div>
      </div>
    </div>
    <nav class="nav-links">
      <span class="nav-link-pill accent">홈</span>
      <span class="nav-link-pill">데이터 허브(예정)</span>
      <a href="https://syc2070-source.github.io/addiction-society/" class="nav-link-pill">중독사회로 이동 ↗</a>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-title-row">
      <div class="hero-title">오늘의 중독·시사 브리핑</div>
      <div class="hero-tag">전 세계 도박·게임·알코올·약물·디지털 중독과 구조적 위험 요약</div>
    </div>
    <p class="hero-subtitle">
      도박·게임·알코올·약물·디지털 중독 관련 글로벌 뉴스, 그리고
      구조적 위험을 보여 주는 시사 이슈를 선별해 한국어로 요약합니다.
      데이터는 <code>data/news.txt</code> 와 <code>data/news_auto.txt</code> 에서 불러옵니다.
    </p>
  </section>

  <section class="filter-bar">
    <div class="filter-top-row">
      <div class="filter-top-row-left" id="filter-info">
        카테고리 필터 · 현재: <strong>전체</strong>
      </div>
      <div class="filter-top-row-right" id="count-info">
        총 0건 (수동 기사 + 자동 기사)
      </div>
    </div>
    <div class="chip-row" id="category-chips">
      <button class="chip active" data-category="전체">전체</button>
      <button class="chip" data-category="도박정책">도박정책</button>
      <button class="chip" data-category="게임·디지털">게임·디지털</button>
      <button class="chip" data-category="알코올·약물">알코올·약물</button>
      <button class="chip" data-category="시사">시사</button>
    </div>
  </section>

  <section class="grid">
    <div>
      <div class="section-title-row">
        <div class="section-title">최신 기사</div>
        <div class="section-sub" id="list-subtitle">전체 카테고리</div>
      </div>
      <div class="article-list" id="article-list"></div>
    </div>

    <aside>
      <div class="section-title-row">
        <div class="section-title">TODAY&apos;S FOCUS</div>
        <div class="section-sub" id="focus-subtitle">선택된 포커스 기사</div>
      </div>
      <div class="focus-card" id="focus-card">
        <p class="focus-title">로딩 중…</p>
        <p class="focus-summary">뉴스 데이터를 불러오는 중입니다.</p>
      </div>
    </aside>
  </section>

  <footer>
    <div>© 2025 중독뉴스 · Addiction Intelligence Newsroom · GitHub Pages 기반 정적 사이트</div>
    <div>데이터 파일:
      <a class="muted-link" href="data/news.txt">news.txt</a> ·
      <a class="muted-link" href="data/news_auto.txt">news_auto.txt</a>
    </div>
  </footer>
</div>

<script>
  // 전역 상태
  let ALL_ARTICLES = [];
  let CURRENT_CATEGORY = "전체";

  document.addEventListener("DOMContentLoaded", () => {
    setupCategoryChips();
    loadAllNews();
  });

  function setupCategoryChips() {
    const chips = document.querySelectorAll("#category-chips .chip");
    chips.forEach(chip => {
      chip.addEventListener("click", () => {
        chips.forEach(c => c.classList.remove("active"));
        chip.classList.add("active");
        CURRENT_CATEGORY = chip.dataset.category || "전체";
        renderArticles();
      });
    });
  }

  async function loadAllNews() {
    try {
      const [manualText, autoText] = await Promise.all([
        fetch("data/news.txt").then(r => r.ok ? r.text() : ""),
        fetch("data/news_auto.txt").then(r => r.ok ? r.text() : "")
      ]);

      const manualArticles = parseNewsText(manualText, "manual");
      const autoArticles = parseNewsText(autoText, "auto");

      ALL_ARTICLES = [...manualArticles, ...autoArticles]
        .filter(a => a.title)
        .sort((a, b) => {
          if (a.dateObj && b.dateObj) return b.dateObj - a.dateObj;
          if (a.dateObj) return -1;
          if (b.dateObj) return 1;
          return 0;
        });

      renderArticles();
    } catch (e) {
      console.error(e);
      const card = document.getElementById("focus-card");
      card.innerHTML = "<p class='focus-summary'>뉴스 데이터를 불러오는 중 오류가 발생했습니다. data/news.txt 와 data/news_auto.txt 가 존재하는지 확인해 주세요.</p>";
    }
  }

  // news.txt / news_auto.txt 공통 파서
  function parseNewsText(text, sourceType) {
    const articles = [];
    if (!text || !text.trim()) return articles;

    // "=== 기사1" 기준으로 분리
    const blocks = text.split(/=== 기사[^\n]*/g);
    for (const rawBlock of blocks) {
      const block = rawBlock.trim();
      if (!block) continue;

      const lines = block.split(/\r?\n/);
      const art = {
        sourceType,
        title: "",
        category: "기타",
        date: "",
        dateObj: null,
        country: "",
        source: "",
        url: "",
        summary: ""
      };

      let inSummary = false;
      const summaryLines = [];

      for (let line of lines) {
        line = line.trim();
        if (!line) {
          if (inSummary) summaryLines.push("");
          continue;
        }
        if (line.startsWith("제목:")) {
          art.title = line.replace("제목:", "").trim();
        } else if (line.startsWith("카테고리:")) {
          art.category = line.replace("카테고리:", "").trim();
        } else if (line.startsWith("날짜:")) {
          const d = line.replace("날짜:", "").trim();
          art.date = d;
          const dt = parseKoreanDate(d);
          if (dt) art.dateObj = dt;
        } else if (line.startsWith("국가:")) {
          art.country = line.replace("국가:", "").trim();
        } else if (line.startsWith("출처:")) {
          art.source = line.replace("출처:", "").trim();
        } else if (line.startsWith("링크:")) {
          art.url = line.replace("링크:", "").trim();
        } else if (line.startsWith("요약:")) {
          inSummary = true;
        } else if (inSummary) {
          summaryLines.push(line);
        }
      }

      art.summary = summaryLines.join("\n").trim();
      articles.push(art);
    }
    return articles;
  }

  function parseKoreanDate(str) {
    // "2025-11-23" 같은 형식 기준
    if (!str) return null;
    // 공백 제거
    const trimmed = str.trim();
    // YYYY-MM-DD 형태면 그대로
    if (/^\d{4}-\d{2}-\d{2}$/.test(trimmed)) {
      return new Date(trimmed + "T00:00:00");
    }
    // 그 외는 Date가 이해하면 쓰고, 안 되면 null
    const dt = new Date(trimmed);
    return isNaN(dt.getTime()) ? null : dt;
  }

  function renderArticles() {
    const listEl = document.getElementById("article-list");
    const filterInfo = document.getElementById("filter-info");
    const listSubtitle = document.getElementById("list-subtitle");
    const countInfo = document.getElementById("count-info");

    if (!ALL_ARTICLES.length) {
      listEl.innerHTML = "<p class='section-sub'>표시할 기사가 없습니다.</p>";
      return;
    }

    const filtered = ALL_ARTICLES.filter(a =>
      CURRENT_CATEGORY === "전체" || a.category === CURRENT_CATEGORY
    );

    filterInfo.innerHTML = `카테고리 필터 · 현재: <strong>${CURRENT_CATEGORY}</strong>`;
    listSubtitle.textContent = CURRENT_CATEGORY === "전체"
      ? "전체 카테고리"
      : `${CURRENT_CATEGORY} 카테고리`;

    const manualCount = filtered.filter(a => a.sourceType === "manual").length;
    const autoCount = filtered.filter(a => a.sourceType === "auto").length;
    countInfo.textContent = `총 ${filtered.length}건 (수동 ${manualCount} · 자동 ${autoCount})`;

    listEl.innerHTML = "";
    filtered.forEach((art, idx) => {
      const card = document.createElement("article");
      card.className = "article-card";
      card.innerHTML = renderArticleCardHTML(art);
      card.addEventListener("click", () => {
        renderFocusCard(art);
        // 스크롤 작은 화면용
        if (window.innerWidth < 900) {
          document.getElementById("focus-card").scrollIntoView({ behavior: "smooth", block: "start" });
        }
      });
      listEl.appendChild(card);
      if (idx === 0) {
        renderFocusCard(art);
      }
    });
  }

  function renderArticleCardHTML(art) {
    const badge =
      art.sourceType === "auto"
        ? '<span class="pill pill-badge-auto">AUTO</span>'
        : '<span class="pill pill-badge-editor">EDITOR</span>';

    const cat = art.category ? `<span class="pill pill-cat">${escapeHtml(art.category)}</span>` : "";
    const country = art.country ? `<span class="pill pill-country">${escapeHtml(art.country)}</span>` : "";
    const date = art.date ? `<span class="pill pill-date">${escapeHtml(art.date)}</span>` : "";
    const source = art.source ? `<span class="pill pill-source">${escapeHtml(art.source)}</span>` : "";

    const shortSummary = art.summary.length > 180
      ? art.summary.slice(0, 180) + "…"
      : art.summary;

    const urlPart = art.url
      ? `<a href="${escapeAttribute(art.url)}" target="_blank" rel="noopener">원문 보기 ↗</a>`
      : "";

    return `
      <div class="article-tag-row">
        ${badge}
        ${country}
        ${date}
        ${cat}
        ${source}
      </div>
      <div class="article-title-row">
        <div class="article-title">${escapeHtml(art.title || "(제목 없음)")}</div>
      </div>
      <div class="article-summary">${escapeHtml(shortSummary || "")}</div>
      <div class="article-footer">
        <div>${urlPart}</div>
        <div class="article-footer-right">
          ${art.sourceType === "auto" ? "자동 수집·요약" : "편집자 선택 기사"}
        </div>
      </div>
    `;
  }

  function renderFocusCard(art) {
    const card = document.getElementById("focus-card");
    const subtitle = document.getElementById("focus-subtitle");

    subtitle.textContent = `${art.category || "기타"} · ${art.country || ""}`.trim();

    const badge =
      art.sourceType === "auto"
        ? '<span class="pill pill-badge-auto">AUTO</span>'
        : '<span class="pill pill-badge-editor">EDITOR</span>';

    const cat = art.category ? `<span class="pill pill-cat">${escapeHtml(art.category)}</span>` : "";
    const country = art.country ? `<span class="pill pill-country">${escapeHtml(art.country)}</span>` : "";
    const date = art.date ? `<span class="pill pill-date">${escapeHtml(art.date)}</span>` : "";
    const source = art.source ? `<span class="pill pill-source">${escapeHtml(art.source)}</span>` : "";

    const urlPart = art.url
      ? `<a href="${escapeAttribute(art.url)}" target="_blank" rel="noopener">원문 전체 보기 ↗</a>`
      : "";

    card.innerHTML = `
      <p class="focus-title">[${escapeHtml(art.category || "기타")}] ${escapeHtml(art.country || "")} · ${escapeHtml(art.date || "")}</p>
      <div class="focus-tag-row">
        ${badge}
        ${country}
        ${date}
        ${cat}
        ${source}
      </div>
      <p class="focus-heading">${escapeHtml(art.title || "(제목 없음)")}</p>
      <p class="focus-summary">${escapeHtml(art.summary || "")}</p>
      <div class="focus-footer">
        <div>${urlPart}</div>
        <div>${art.sourceType === "auto" ? "자동 수집·요약 기사" : "편집자 선정 기사"}</div>
      </div>
    `;
  }

  function escapeHtml(str) {
    return (str || "")
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  function escapeAttribute(str) {
    return escapeHtml(str).replace(/"/g, "&quot;");
  }
</script>
</body>
</html>
